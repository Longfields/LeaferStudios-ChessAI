try{var board,pC,game=new Chess,pieces={wK:"https://upload.wikimedia.org/wikipedia/commons/4/42/Chess_klt45.svg",bK:"https://upload.wikimedia.org/wikipedia/commons/f/f0/Chess_kdt45.svg",wQ:"https://upload.wikimedia.org/wikipedia/commons/1/15/Chess_qlt45.svg",bQ:"https://upload.wikimedia.org/wikipedia/commons/4/47/Chess_qdt45.svg",wR:"https://upload.wikimedia.org/wikipedia/commons/7/72/Chess_rlt45.svg",bR:"https://upload.wikimedia.org/wikipedia/commons/f/ff/Chess_rdt45.svg",wB:"https://upload.wikimedia.org/wikipedia/commons/b/b1/Chess_blt45.svg",bB:"https://upload.wikimedia.org/wikipedia/commons/9/98/Chess_bdt45.svg",wN:"https://upload.wikimedia.org/wikipedia/commons/7/70/Chess_nlt45.svg",bN:"https://upload.wikimedia.org/wikipedia/commons/e/ef/Chess_ndt45.svg",wP:"https://upload.wikimedia.org/wikipedia/commons/4/45/Chess_plt45.svg",bP:"https://upload.wikimedia.org/wikipedia/commons/c/c7/Chess_pdt45.svg"},sD=3,eElo=0,mxRt=function(e,o,r){for(var a,t=o.ugly_moves(),s=-9999,i=0;i<t.length;i++){var n=t[i];o.ugly_move(n);var u=mx(e-1,o,-1e4,1e4,!r);o.undo(),u>=s&&(s=u,a=n)}return a},mx=function(e,o,r,a,t){if(pC++,0===e)return-eBoard(o.board());var s=o.ugly_moves();if(t){for(var i=-9999,n=0;n<s.length&&(o.ugly_move(s[n]),i=Math.max(i,mx(e-1,o,r,a,!t)),o.undo(),!(a<=(r=Math.max(r,i))));n++);return i}for(i=9999,n=0;n<s.length&&(o.ugly_move(s[n]),i=Math.min(i,mx(e-1,o,r,a,!t)),o.undo(),!((a=Math.min(a,i))<=r));n++);return i},eBoard=function(e){for(var o=0,r=0;r<8;r++)for(var a=0;a<8;a++)o+=getPieceValue(e[r][a],r,a);return o},arrayDotReverse=function(e){return e.slice().reverse()},pEvW=[[0,0,0,0,0,0,0,0],[5,5,5,5,5,5,5,5],[1,1,2,3,3,2,1,1],[.5,.5,1,2.5,2.5,1,.5,.5],[0,0,0,2,2,0,0,0],[.5,-.5,-1,0,0,-1,-.5,.5],[.5,1,1,-2,-2,1,1,.5],[0,0,0,0,0,0,0,0]],pEvB=arrayDotReverse(pEvW),kEv=[[-5,-4,-3,-3,-3,-3,-4,-5],[-4,-2,0,0,0,0,-2,-4],[-3,0,1,1.5,1.5,1,0,-3],[-3,.5,1.5,2,2,1.5,.5,-3],[-3,0,1.5,2,2,1.5,0,-3],[-3,.5,1,1.5,1.5,1,.5,-3],[-4,-2,0,.5,.5,0,-2,-4],[-5,-4,-3,-3,-3,-3,-4,-5]],bEvW=[[-2,-1,-1,-1,-1,-1,-1,-2],[-1,0,0,0,0,0,0,-1],[-1,0,.5,1,1,.5,0,-1],[-1,.5,.5,1,1,.5,.5,-1],[-1,0,1,1,1,1,0,-1],[-1,1,1,1,1,1,1,-1],[-1,.5,0,0,0,0,.5,-1],[-2,-1,-1,-1,-1,-1,-1,-2]],bEvB=arrayDotReverse(bEvW),rEvW=[[0,0,0,0,0,0,0,0],[.5,1,1,1,1,1,1,.5],[-.5,0,0,0,0,0,0,-.5],[-.5,0,0,0,0,0,0,-.5],[-.5,0,0,0,0,0,0,-.5],[-.5,0,0,0,0,0,0,-.5],[-.5,0,0,0,0,0,0,-.5],[0,0,0,.5,.5,0,0,0]],rEvB=arrayDotReverse(rEvW),qEv=[[-2,-1,-1,-.5,-.5,-1,-1,-2],[-1,0,0,0,0,0,0,-1],[-1,0,.5,.5,.5,.5,0,-1],[-.5,0,.5,.5,.5,.5,0,-.5],[0,0,.5,.5,.5,.5,0,-.5],[-1,.5,.5,.5,.5,.5,0,-1],[-1,0,.5,0,0,0,0,-1],[-2,-1,-1,-.5,-.5,-1,-1,-2]],kEvW=[[-3,-4,-4,-5,-5,-4,-4,-3],[-3,-4,-4,-5,-5,-4,-4,-3],[-3,-4,-4,-5,-5,-4,-4,-3],[-3,-4,-4,-5,-5,-4,-4,-3],[-2,-3,-3,-4,-4,-3,-3,-2],[-1,-2,-2,-2,-2,-2,-2,-1],[2,2,0,0,0,0,2,2],[2,3,1,0,0,1,3,2]],kEvB=arrayDotReverse(kEvW),getPieceValue=function(e,o,r){if(null===e)return 0;var a=function(e,o,r,a){if("p"===e.type)return 10+(o?pEvW[a][r]:pEvB[a][r]);if("r"===e.type)return 50+(o?rEvW[a][r]:rEvB[a][r]);if("n"===e.type)return 30+kEv[a][r];if("b"===e.type)return 30+(o?bEvW[a][r]:bEvB[a][r]);if("q"===e.type)return 90+qEv[a][r];if("k"===e.type)return 900+(o?kEvW[a][r]:kEvB[a][r]);throw"Unknown piece type: "+e.type}(e,"w"===e.color,o,r);return"w"===e.color?a:-a},onDragStart=function(e,o,r,a){if(!0===game.in_checkmate()||!0===game.in_draw()||-1!==o.search(/^b/))return!1},makeBestMove=function(){var e=getBestMove(game);game.ugly_move(e),board.position(game.fen()),rMh(game.history()),game.game_over()&&scene(2)},restartGame=function(){game.reset(),board.position("start","fast"),$("#history").empty(),selectedPiece=null,removeGreySquares()},getBestMove=function(e){if(e.game_over()&&scene(2),pC=0,!0!==e.game_over()){1===sD?eElo=100:2===sD?eElo=600:3===sD?eElo=1200:4===sD?eElo=1600:5===sD&&(eElo=1900);var o=sD,r=(new Date).getTime(),a=mxRt(o,e,!0),t=(new Date).getTime()-r,s=1e3*pC/t;return $("#search-depth").text(sD),$("#estimated-elo").text(eElo),$("#position-count").text(pC),$("#time").text(t/1e3),$("#positions-per-s").text(Math.round(s)),a}},rMh=function(e){var o=$("#history").empty();o.empty();for(var r=0;r<e.length;r+=2)o.append("<span>"+(r/2+1)+". "+e[r]+" "+(e[r+1]?e[r+1]:" ")+"</span><br>");o.scrollTop(o[0].scrollHeight)},onDrop=function(e,o){var r=game.move({from:e,to:o,promotion:"q"});if(removeGreySquares(),null===r)return"snapback";rMh(game.history()),window.setTimeout(makeBestMove,250)},removeGreySquares=function(){$("#board .square-55d63").css("box-shadow",""),$("#board .square-55d63").css("background","")},greySquare=function(e){var o=$("#board .square-"+e),r="inset 0px 0px 2vw 4vw var(--white-square)";o.hasClass("black-3c85d")&&(r="inset 0px 0px 2vw 4vw var(--black-square)"),o.css("box-shadow",r);var a=$("#board .square-"+e),t="rgba(66, 66, 66)";a.hasClass("black-3c85d")&&(t="rgba(66, 66, 66)"),a.css("background",t)},onSnapEnd=function(){board.position(game.fen())},onMouseoverSquare=function(e,o){var r=game.moves({square:e,verbose:!0});if(0!==r.length){greySquare(e);for(var a=0;a<r.length;a++)greySquare(r[a].to)}},onMouseoutSquare=function(e,o){removeGreySquares()},GameBoard={draggable:!0,pieceTheme:function(e){return pieces[e]},position:"start",onDragStart:onDragStart,onDrop:onDrop,moveSpeed:"fast",onMouseoutSquare:onMouseoutSquare,onMouseoverSquare:onMouseoverSquare,onSnapEnd:onSnapEnd};board=ChessBoard("board",GameBoard)}catch(e){document.body.innerHTML=e}
